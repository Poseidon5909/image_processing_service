# Post-Deployment Setup Guide

After deploying your backend on Render and frontend on Vercel, follow these steps to connect them:

## Step 1: Get Your Render Backend URL

1. Go to your Render dashboard: https://dashboard.render.com
2. Click on your `image-processing-api` service
3. Copy the URL (e.g., `https://image-processing-api.onrender.com`)

## Step 2: Update CORS Origins on Render

1. In Render dashboard, go to your `image-processing-api` service
2. Click on **Environment** in the left sidebar
3. Find the `CORS_ORIGINS` variable
4. Update its value to include your Vercel frontend URL:
   ```
   http://localhost:3000,https://your-frontend-app.vercel.app
   ```
   Replace `your-frontend-app.vercel.app` with your actual Vercel URL
5. Click **Save Changes**
6. The service will automatically redeploy

## Step 3: Configure Vercel Environment Variables

1. Go to your Vercel dashboard: https://vercel.com/dashboard
2. Select your frontend project
3. Go to **Settings** → **Environment Variables**
4. Add these variables:

   | Name | Value | Environments |
   |------|-------|--------------|
   | `NEXT_PUBLIC_API_URL` | `https://image-processing-api.onrender.com` | Production, Preview, Development |
   | `NEXT_PUBLIC_ENV` | `production` | Production |

   Replace the URL with your actual Render backend URL
5. Click **Save**
6. Go to **Deployments** tab and click **Redeploy** on the latest deployment

## Step 4: Initialize Database Tables

Your database tables need to be created. You have two options:

### Option A: Automatic (via API call)
The tables are created automatically when the app starts due to `Base.metadata.create_all(bind=engine)` in the code.

### Option B: Manual (recommended for production)
1. Connect to your Render service shell:
   - In Render dashboard, click **Shell** button on your service
2. Run Python migrations or create tables:
   ```bash
   python -c "from app.db import engine, Base; from app.models import User, Image, ImageTransformation; Base.metadata.create_all(bind=engine)"
   ```

## Step 5: Test Your Deployment

1. **Test Backend Health**
   - Visit: `https://your-api.onrender.com/docs`
   - You should see the FastAPI Swagger documentation

2. **Test Frontend**
   - Visit your Vercel URL
   - Try registering a new user
   - Try logging in
   - Upload an image
   - Apply transformations

## Step 6: Monitor and Debug

### Check Backend Logs
- Render Dashboard → Your Service → **Logs** tab
- Look for any errors or issues

### Check Frontend Logs
- Vercel Dashboard → Your Project → **Deployments** → Click on deployment → **View Function Logs**

### Common Issues

#### CORS Errors
- **Problem**: Browser console shows CORS errors
- **Solution**: Make sure your Vercel URL is added to `CORS_ORIGINS` in Render environment variables

#### 404 on API Calls
- **Problem**: Frontend can't reach backend
- **Solution**: Verify `NEXT_PUBLIC_API_URL` in Vercel is correct and includes `https://`

#### Database Connection Errors
- **Problem**: Backend fails to connect to database
- **Solution**: Check that `DATABASE_URL` in Render is properly linked to your PostgreSQL database

#### Authentication Issues
- **Problem**: Login/register not working
- **Solution**: Ensure `SECRET_KEY` and `ALGORITHM` environment variables are set on Render

## Step 7: Optional Improvements

### Enable Custom Domain
- **Backend**: Add custom domain in Render settings
- **Frontend**: Add custom domain in Vercel settings

### Set Up S3 for Image Storage (recommended for production)
1. Create an AWS S3 bucket
2. In Render, update environment variables:
   - `STORAGE_BACKEND` = `s3`
   - `S3_BUCKET_NAME` = your bucket name
   - `S3_ACCESS_KEY` = your AWS access key
   - `S3_SECRET_KEY` = your AWS secret key
   - `S3_REGION` = your AWS region (e.g., `us-east-1`)

### Monitor Performance
- Set up Render metrics alerts
- Use Vercel Analytics for frontend performance
- Monitor database usage in Render dashboard

## Security Checklist

- [ ] Change `SECRET_KEY` from default value (auto-generated by Render)
- [ ] Enable HTTPS only (both platforms do this by default)
- [ ] Review CORS_ORIGINS to only include your domains
- [ ] Set up rate limiting (already configured in backend)
- [ ] Review and update any default passwords or keys
- [ ] Enable Vercel password protection for preview deployments (optional)

## Need Help?

- **Render Docs**: https://render.com/docs
- **Vercel Docs**: https://vercel.com/docs
- **FastAPI Docs**: https://fastapi.tiangolo.com
- **Next.js Docs**: https://nextjs.org/docs

---

✅ Your application should now be fully deployed and functional!
